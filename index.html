<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-25TWGT6LCN"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-25TWGT6LCN');
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Can I afford this house? Get an instant, free answer using the 28% rule. No email, no signup, no cost. Just clarity on home affordability.">
    <meta name="keywords" content="house affordability calculator, mortgage calculator, can I afford this house, home buying calculator, mortgage payment calculator">
    <title>Can I Afford This House? - Free Calculator | No Email Required</title>
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Can I Afford This House? - Free Calculator">
    <meta property="og:description" content="Find out if you can afford that house instantly. Free calculator with no email required.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://nyanguno.github.io/caniaffordthishouse">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè†</text></svg>">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Can I Afford This House? Calculator",
        "description": "Free house affordability calculator. Find out if you can afford that house instantly - no email required.",
        "url": "https://nyanguno.github.io/caniaffordthishouse",
        "applicationCategory": "FinanceApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "featureList": [
            "House affordability calculation",
            "Mortgage payment estimation",
            "Debt-to-income ratio analysis",
            "Credit score based interest rates",
            "No email required",
            "Mobile friendly"
        ],
        "author": {
            "@type": "Organization",
            "name": "Can I Afford This House"
        }
    }
    </script>
    
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "Is the 28% rule always accurate?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "The 28% rule is a conservative guideline used by most lenders. Some people can comfortably afford more, while others should aim for less depending on their other debts, lifestyle, and financial goals."
                }
            },
            {
                "@type": "Question",
                "name": "What if I have other debts?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Lenders also look at your total debt-to-income ratio (including credit cards, car loans, etc.), which should typically be below 36-43%. If you have significant other debts, you may need to aim for a lower housing payment."
                }
            },
            {
                "@type": "Question",
                "name": "How accurate are the interest rates?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "We use estimated rates based on typical ranges for different credit scores. Actual rates vary by lender, loan type, and market conditions. Always get pre-approved for the most accurate rate."
                }
            }
        ]
    }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .hero {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 0;
        }
        
        .hero h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 16px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        
        .hero .subtitle {
            font-size: 1rem;
            opacity: 0.8;
        }
        
        .calculator-card {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
            font-size: 1rem;
        }
        
        .form-group input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: #f9fafb;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-group select {
            width: 100%;
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: #f9fafb;
        }
        
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .optional {
            font-weight: 400;
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }
        
        .button-group button {
            flex: 1;
        }
        
        .export-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .export-btn:hover {
            background: #059669;
            transform: translateY(-1px);
        }
        
        .clear-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .clear-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }
        
        .history-section {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            margin-bottom: 40px;
            display: none;
        }
        
        .history-section.show {
            display: block;
        }
        
        .history-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            position: relative;
        }
        
        .history-item:last-child {
            margin-bottom: 0;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .history-title {
            font-weight: 600;
            color: #374151;
        }
        
        .history-timestamp {
            font-size: 0.9rem;
            color: #6b7280;
        }
        
        .history-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .history-stat {
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 8px;
        }
        
        .history-stat-label {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 4px;
        }
        
        .history-stat-value {
            font-weight: 600;
            color: #374151;
        }
        
        .percentage-highlight {
            font-size: 1.2rem;
            font-weight: 700;
            margin-top: 8px;
        }
        
        .percentage-highlight.good {
            color: #10b981;
        }
        
        .percentage-highlight.warning {
            color: #f59e0b;
        }
        
        .percentage-highlight.danger {
            color: #ef4444;
        }
        
        .calculate-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 24px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 16px;
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .calculate-btn:active {
            transform: translateY(0);
        }
        
        .result {
            margin-top: 32px;
            padding: 24px;
            border-radius: 12px;
            font-size: 1.1rem;
            display: none;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result.success {
            background: #ecfdf5;
            border: 2px solid #10b981;
            color: #065f46;
        }
        
        .result.warning {
            background: #fffbeb;
            border: 2px solid #f59e0b;
            color: #92400e;
        }
        
        .result.danger {
            background: #fef2f2;
            border: 2px solid #ef4444;
            color: #991b1b;
        }
        
        .result-icon {
            font-size: 2rem;
            margin-bottom: 12px;
            display: block;
        }
        
        .payment-breakdown {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin-top: 16px;
        }
        
        .payment-breakdown h4 {
            margin-bottom: 12px;
            color: #374151;
        }
        
        .payment-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 4px 0;
        }
        
        .payment-item.total {
            border-top: 2px solid #e5e7eb;
            padding-top: 12px;
            margin-top: 12px;
            font-weight: 600;
        }
        
        .info-section {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            margin-bottom: 40px;
        }
        
        .info-section h2 {
            color: #1f2937;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .info-section p {
            margin-bottom: 16px;
            color: #6b7280;
            line-height: 1.7;
        }
        
        .testimonials {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            margin-bottom: 40px;
        }
        
        .testimonials h2 {
            color: #1f2937;
            margin-bottom: 30px;
            font-size: 1.8rem;
            text-align: center;
        }
        
        .testimonial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .testimonial-item {
            background: #f8fafc;
            border-radius: 12px;
            padding: 24px;
            border-left: 4px solid #6366f1;
        }
        
        .testimonial-content {
            margin-bottom: 16px;
        }
        
        .testimonial-content p {
            color: #374151;
            line-height: 1.6;
            font-style: italic;
            margin: 0;
        }
        
        .testimonial-author strong {
            color: #1f2937;
            font-weight: 600;
        }
        
        .testimonial-author span {
            color: #6b7280;
            font-size: 0.9rem;
            display: block;
            margin-top: 4px;
        }
        
        .faq {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }
        
        .faq h2 {
            color: #1f2937;
            margin-bottom: 24px;
            font-size: 1.8rem;
        }
        
        .faq-item {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .faq-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .faq-item h3 {
            color: #374151;
            margin-bottom: 12px;
            font-size: 1.2rem;
        }
        
        .faq-item p {
            color: #6b7280;
            line-height: 1.7;
        }
        
        .donation-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 60px 0;
        }
        
        .donation-card {
            background: white;
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 0 auto;
        }
        
        .donation-card h3 {
            color: #1f2937;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .donation-card p {
            color: #6b7280;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .donation-card form {
            margin: 30px 0;
        }
        
        .donation-note {
            font-size: 0.9rem;
            color: #9ca3af;
            margin-top: 20px !important;
            margin-bottom: 0 !important;
        }
        
        .footer {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255,255,255,0.8);
        }
        
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1.1rem;
            }
            
            .calculator-card,
            .info-section,
            .testimonials,
            .faq,
            .donation-card {
                padding: 24px;
            }
            
            .testimonial-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .container {
                padding: 16px;
            }
        }
        
        @media (max-width: 480px) {
            .hero h1 {
                font-size: 1.8rem;
            }
            
            .calculator-card,
            .info-section,
            .faq {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero">
            <h1>Can I Afford This House?</h1>
            <p>Free house affordability calculator for first-time home buyers. See if you can afford a home based on your income, credit score, and location ‚Äî in 30 seconds.</p>
            <p>Get an instant answer to your biggest question</p>
            <p class="subtitle">No email required ‚Ä¢ 100% free ‚Ä¢ Takes 30 seconds</p>
        </div>
        
        <div class="calculator-card">
            <div class="currency-selector">
                <div class="form-group">
                    <label for="currency">Currency:</label>
                    <select id="currency">
                        <option value="USD">üá∫üá∏ USD - US Dollar</option>
                        <option value="EUR">üá™üá∫ EUR - Euro</option>
                        <option value="GBP">üá¨üáß GBP - British Pound</option>
                        <option value="CAD">üá®üá¶ CAD - Canadian Dollar</option>
                        <option value="AUD">üá¶üá∫ AUD - Australian Dollar</option>
                        <option value="JPY">üáØüáµ JPY - Japanese Yen</option>
                        <option value="CHF">üá®üá≠ CHF - Swiss Franc</option>
                        <option value="SEK">üá∏üá™ SEK - Swedish Krona</option>
                        <option value="NOK">üá≥üá¥ NOK - Norwegian Krone</option>
                        <option value="DKK">üá©üá∞ DKK - Danish Krone</option>
                        <option value="NZD">üá≥üáø NZD - New Zealand Dollar</option>
                        <option value="SGD">üá∏üá¨ SGD - Singapore Dollar</option>
                        <option value="HKD">üá≠üá∞ HKD - Hong Kong Dollar</option>
                        <option value="INR">üáÆüá≥ INR - Indian Rupee</option>
                        <option value="CNY">üá®üá≥ CNY - Chinese Yuan</option>
                        <option value="KRW">üá∞üá∑ KRW - South Korean Won</option>
                        <option value="MXN">üá≤üáΩ MXN - Mexican Peso</option>
                        <option value="BRL">üáßüá∑ BRL - Brazilian Real</option>
                        <option value="ZAR">üáøüá¶ ZAR - South African Rand</option>
                        <option value="RUB">üá∑üá∫ RUB - Russian Ruble</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="calculatorMode">Calculator Mode:</label>
                    <select id="calculatorMode">
                        <option value="affordability">Affordability Calculator (Can I afford this house?)</option>
                        <option value="reverse">Reverse Calculator (What house can I afford?)</option>
                    </select>
                </div>
            </div>
            
            <form id="affordabilityForm">
                <div class="form-group" id="housePriceGroup">
                    <label for="housePrice">House Price (<span id="housePriceCurrency">$</span>)</label>
                    <input type="text" id="housePrice" placeholder="e.g. 350,000" required>
                </div>
                
                <div class="form-group" id="maxPaymentGroup" style="display: none;">
                    <label for="maxPayment">Maximum Monthly Payment (<span id="maxPaymentCurrency">$</span>)</label>
                    <input type="text" id="maxPayment" placeholder="e.g. 2,500">
                </div>
                
                <div class="form-group">
                    <label for="annualIncome">Annual Income (<span id="annualIncomeCurrency">$</span>)</label>
                    <input type="text" id="annualIncome" placeholder="e.g. 70,000" required>
                </div>
                
                <div class="form-group">
                    <label for="downPayment">Down Payment (<span id="downPaymentCurrency">$</span>)</label>
                    <input type="text" id="downPayment" placeholder="e.g. 50,000" required>
                </div>
                
                <div class="form-group">
                    <label for="creditScore">Credit Score (600-850) <span class="optional">or select "No Credit Score"</span></label>
                    <select id="creditScoreType">
                        <option value="have_score">I have a credit score</option>
                        <option value="no_score">I don't have a credit score</option>
                    </select>
                </div>
                
                <div class="form-group" id="creditScoreInput">
                    <label for="creditScore">Enter Your Credit Score:</label>
                    <input type="number" id="creditScore" placeholder="e.g. 720" min="600" max="850">
                </div>
                
                <div class="form-group" id="noCreditOptions" style="display: none;">
                    <label for="creditProfile">Select Your Credit Profile:</label>
                    <select id="creditProfile">
                        <option value="excellent">Excellent Credit History (Always pay on time, low debt)</option>
                        <option value="good">Good Credit History (Usually pay on time, moderate debt)</option>
                        <option value="fair">Fair Credit History (Some late payments, higher debt)</option>
                        <option value="poor">Poor Credit History (Frequent late payments, high debt)</option>
                        <option value="no_history">No Credit History (First-time borrower)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="loanTerm">Loan Term (Years):</label>
                    <select id="loanTerm">
                        <option value="30">30-Year</option>
                        <option value="25">25-Year</option>
                        <option value="20">20-Year</option>
                        <option value="15">15-Year</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="propertyTax">Annual Property Tax <span class="optional">(or leave blank to estimate)</span></label>
                    <input type="text" id="propertyTax" placeholder="e.g. 4,320 (for monthly amount)" value="">
                </div>
                
                <div class="form-group">
                    <label for="hoaFees">Monthly HOA Fees <span class="optional">(optional - default 0)</span></label>
                    <input type="text" id="hoaFees" placeholder="e.g. 150" min="0" step="1">
                </div>
                
                <div class="form-group">
                    <label for="interestRate">Interest Rate (%) <span class="optional">(optional - auto-calculated from credit score)</span></label>
                    <input type="number" id="interestRate" placeholder="e.g. 7.25" min="3" max="15" step="0.01">
                </div>
                
                <div class="form-group">
                    <label for="propertyTaxRate">Property Tax Rate (%) <span class="optional">(optional - default 1.2%)</span></label>
                    <input type="number" id="propertyTaxRate" placeholder="e.g. 1.25" min="0" max="5" step="0.01">
                </div>
                
                <div class="form-group">
                    <label for="insuranceRate">Insurance Rate (%) <span class="optional">(optional - default 0.3%)</span></label>
                    <input type="number" id="insuranceRate" placeholder="e.g. 0.35" min="0" max="2" step="0.01">
                </div>
                
                <div class="form-group">
                    <label for="extraPayment">Extra Monthly Payment <span class="optional">(optional - see payoff impact)</span></label>
                    <input type="text" id="extraPayment" placeholder="e.g. 200" min="0" step="1">
                </div>
                
                <button type="submit" class="calculate-btn">Calculate Affordability</button>
            </form>
            
            <div id="result" class="result"></div>
            
            <div class="button-group" id="exportButtons" style="display: none;">
                <button type="button" class="export-btn" onclick="exportToCSV()">Export CSV</button>
                <button type="button" class="export-btn" onclick="exportToText()">Copy Results</button>
                <button type="button" class="clear-btn" onclick="clearHistory()">Clear History</button>
            </div>
        </div>
        
        <div class="history-section" id="historySection">
            <h2>Calculation History</h2>
            <div id="historyContainer">
                <p style="text-align: center; color: #6b7280;">No calculations yet. Run a calculation to see your history here.</p>
            </div>
        </div>
        
        <div class="info-section">
            <h2>How Does This Calculator Work?</h2>
            <p>Our calculator uses the <strong>28% rule</strong> - a widely accepted guideline that suggests your monthly housing payment should not exceed 28% of your gross monthly income.</p>
            <p>We calculate your estimated monthly mortgage payment based on current interest rates (which vary by credit score), add estimated property taxes and insurance, then compare this to 28% of your monthly income.</p>
            <p>This gives you a realistic picture of whether you can comfortably afford the house you're considering, helping you make informed decisions about one of life's biggest purchases.</p>
        </div>
        
        <div class="testimonials">
            <h2>What Our Users Say</h2>
            
            <div class="testimonial-grid">
                <div class="testimonial-item">
                    <div class="testimonial-content">
                        <p>"This calculator saved me from making a huge mistake! I was looking at a $400k house but this showed me I'd be spending 45% of my income. Found a perfect $320k home instead."</p>
                    </div>
                    <div class="testimonial-author">
                        <strong>Sarah M.</strong>
                        <span>First-time homebuyer</span>
                    </div>
                </div>
                
                <div class="testimonial-item">
                    <div class="testimonial-content">
                        <p>"The 15-year vs 30-year comparison feature is brilliant. Showed my wife and I exactly how much we'd save in interest by going with the shorter term. We're building equity so much faster now!"</p>
                    </div>
                    <div class="testimonial-author">
                        <strong>Mike & Jennifer T.</strong>
                        <span>Homeowners</span>
                    </div>
                </div>
                
                <div class="testimonial-item">
                    <div class="testimonial-content">
                        <p>"As a real estate agent, I use this with every client. The custom property tax feature is perfect for our high-tax area. Clients love seeing the exact numbers before we start house hunting."</p>
                    </div>
                    <div class="testimonial-author">
                        <strong>David R.</strong>
                        <span>Real Estate Professional</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="faq">
            <h2>Frequently Asked Questions</h2>
            
            <div class="faq-item">
                <h3>Is the 28% rule always accurate?</h3>
                <p>The 28% rule is a conservative guideline used by most lenders. Some people can comfortably afford more, while others should aim for less depending on their other debts, lifestyle, and financial goals.</p>
            </div>
            
            <div class="faq-item">
                <h3>What if I have other debts?</h3>
                <p>Lenders also look at your total debt-to-income ratio (including credit cards, car loans, etc.), which should typically be below 36-43%. If you have significant other debts, you may need to aim for a lower housing payment.</p>
            </div>
            
            <div class="faq-item">
                <h3>How accurate are the interest rates?</h3>
                <p>We use estimated rates based on typical ranges for different credit scores. Actual rates vary by lender, loan type, and market conditions. Always get pre-approved for the most accurate rate.</p>
            </div>
            
            <div class="faq-item">
                <h3>Should I include HOA fees?</h3>
                <p>Yes! If the property has HOA fees, add them to your estimated monthly payment when considering affordability. Our calculator includes basic property taxes and insurance estimates.</p>
            </div>
        </div>
    </div>
    
    <div class="donation-section">
        <div class="container">
            <div class="donation-card">
                <h3>üíù Support This Free Tool</h3>
                <p>This calculator is completely free and helps thousands of people make informed home buying decisions. If it helped you, consider supporting its development and maintenance.</p>
                <p>Read our <a href="blog.html" style="color: #667eea; text-decoration: none; font-weight: 600;">blog</a> for more insights on home affordability.</p>
                <form action="https://www.paypal.com/donate" method="post" target="_top">
                    <input type="hidden" name="business" value="waitherakelon@gmail.com" />
                    <input type="hidden" name="no_recurring" value="0" />
                    <input type="hidden" name="item_name" value="Support Can I Afford This House Calculator" />
                    <input type="hidden" name="currency_code" value="USD" />
                    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" />
                    <img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
                </form>
                <p class="donation-note">Every contribution helps keep this tool free for everyone! üè†</p>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>&copy; 2024 Can I Afford This House? | Free House Affordability Calculator</p>
    </div>
    
    <script>
        // Global variables for calculation history
        let calculationHistory = [];
        let currentCalculation = null;
        
        // Currency symbols and formatting
        const currencySymbols = {
            'USD': '$', 'EUR': '‚Ç¨', 'GBP': '¬£', 'CAD': 'C$', 'AUD': 'A$', 
            'JPY': '¬•', 'CHF': 'CHF', 'SEK': 'kr', 'NOK': 'kr', 'DKK': 'kr',
            'NZD': 'NZ$', 'SGD': 'S$', 'HKD': 'HK$', 'INR': '‚Çπ', 'CNY': '¬•',
            'KRW': '‚Ç©', 'MXN': '$', 'BRL': 'R$', 'ZAR': 'R', 'RUB': '‚ÇΩ'
        };
        
        // Add input formatting for currency fields and currency change handler
        document.addEventListener('DOMContentLoaded', function() {
            const currencyInputs = ['housePrice', 'annualIncome', 'downPayment', 'propertyTax', 'hoaFees', 'extraPayment', 'maxPayment'];
            
            currencyInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('input', function(e) {
                        formatCurrencyInput(e.target);
                    });
                    
                    input.addEventListener('blur', function(e) {
                        formatCurrencyInput(e.target);
                    });
                }
            });
            
            // Currency change handler
            const currencySelect = document.getElementById('currency');
            if (currencySelect) {
                currencySelect.addEventListener('change', function() {
                    updateCurrencySymbols();
                });
                // Initialize currency symbols
                updateCurrencySymbols();
            }
            
            // Calculator mode change handler
            const calculatorModeSelect = document.getElementById('calculatorMode');
            if (calculatorModeSelect) {
                calculatorModeSelect.addEventListener('change', function() {
                    toggleCalculatorMode();
                });
                // Initialize calculator mode
                toggleCalculatorMode();
            }
            
            // Credit score type handler
            const creditScoreType = document.getElementById('creditScoreType');
            if (creditScoreType) {
                creditScoreType.addEventListener('change', function() {
                    toggleCreditScoreInputs();
                });
                // Initialize credit score inputs
                toggleCreditScoreInputs();
            }
        });
        
        function toggleCreditScoreInputs() {
            const creditScoreType = document.getElementById('creditScoreType').value;
            const creditScoreInput = document.getElementById('creditScoreInput');
            const noCreditOptions = document.getElementById('noCreditOptions');
            
            if (creditScoreType === 'have_score') {
                creditScoreInput.style.display = 'block';
                noCreditOptions.style.display = 'none';
                document.getElementById('creditScore').required = true;
            } else {
                creditScoreInput.style.display = 'none';
                noCreditOptions.style.display = 'block';
                document.getElementById('creditScore').required = false;
            }
        }
        
        function toggleCalculatorMode() {
            const calculatorMode = document.getElementById('calculatorMode').value;
            const housePriceGroup = document.getElementById('housePriceGroup');
            const maxPaymentGroup = document.getElementById('maxPaymentGroup');
            const submitButton = document.querySelector('button[type="submit"]');
            
            if (calculatorMode === 'affordability') {
                housePriceGroup.style.display = 'block';
                maxPaymentGroup.style.display = 'none';
                document.getElementById('housePrice').required = true;
                document.getElementById('maxPayment').required = false;
                if (submitButton) {
                    submitButton.textContent = 'Calculate Affordability';
                }
            } else {
                housePriceGroup.style.display = 'none';
                maxPaymentGroup.style.display = 'block';
                document.getElementById('housePrice').required = false;
                document.getElementById('maxPayment').required = true;
                if (submitButton) {
                    submitButton.textContent = 'Calculate Maximum House Price';
                }
            }
        }
        
        function updateCurrencySymbols() {
            const selectedCurrency = document.getElementById('currency').value;
            const symbol = currencySymbols[selectedCurrency] || '$';
            
            // Update currency symbols in labels
            const currencySpans = ['housePriceCurrency', 'annualIncomeCurrency', 'downPaymentCurrency', 'maxPaymentCurrency'];
            currencySpans.forEach(spanId => {
                const span = document.getElementById(spanId);
                if (span) {
                    span.textContent = symbol;
                }
            });
        }
        
        function formatCurrencyInput(input) {
            let value = input.value.replace(/[^\d.]/g, ''); // Remove all non-digit and non-decimal characters
            
            if (value === '') {
                input.value = '';
                return;
            }
            
            // Handle decimal places
            const parts = value.split('.');
            if (parts.length > 2) {
                value = parts[0] + '.' + parts.slice(1).join('');
            }
            
            // Format with commas
            const number = parseFloat(value);
            if (!isNaN(number)) {
                input.value = number.toLocaleString('en-US', {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 2
                });
            }
        }
        
        document.getElementById('affordabilityForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const calculatorMode = document.getElementById('calculatorMode').value;
            if (calculatorMode === 'affordability') {
                calculateAffordability();
            } else {
                calculateReverseAffordability();
            }
        });
        
        function calculateAffordability() {
            // Get input values (using parseFormattedNumber to handle commas)
            const housePrice = parseFormattedNumber(document.getElementById('housePrice').value);
            const annualIncome = parseFormattedNumber(document.getElementById('annualIncome').value);
            const downPayment = parseFormattedNumber(document.getElementById('downPayment').value);
            
            // Get credit score or profile
            const creditScoreType = document.getElementById('creditScoreType').value;
            let creditScore;
            
            if (creditScoreType === 'have_score') {
                creditScore = parseInt(document.getElementById('creditScore').value);
            } else {
                // Map credit profile to estimated credit score
                const creditProfile = document.getElementById('creditProfile').value;
                const profileToScore = {
                    'excellent': 780,
                    'good': 720,
                    'fair': 650,
                    'poor': 620,
                    'no_history': 650
                };
                creditScore = profileToScore[creditProfile] || 650;
            }
            
            // Get optional inputs with defaults
            const customInterestRate = parseFloat(document.getElementById('interestRate').value);
            const customPropertyTaxRate = parseFloat(document.getElementById('propertyTaxRate').value);
            const customInsuranceRate = parseFloat(document.getElementById('insuranceRate').value);
            const hoaFees = parseFormattedNumber(document.getElementById('hoaFees').value);
            const extraPayment = parseFormattedNumber(document.getElementById('extraPayment').value);
            
            // Validate required inputs
            if (!housePrice || !annualIncome || !downPayment) {
                showResult('Please fill in all required fields.', 'warning', '‚ö†Ô∏è');
                return;
            }
            
            if (creditScoreType === 'have_score' && (!creditScore || creditScore < 600 || creditScore > 850)) {
                showResult('Please enter a credit score between 600 and 850, or select "No Credit Score".', 'warning', '‚ö†Ô∏è');
                return;
            }
            
            if (downPayment >= housePrice) {
                showResult('Down payment cannot be greater than or equal to house price.', 'warning', '‚ö†Ô∏è');
                return;
            }
            
            // Calculate loan amount
            const loanAmount = housePrice - downPayment;
            
            // Determine interest rate with improved precision
            let interestRate;
            if (customInterestRate && customInterestRate > 0) {
                interestRate = Math.round(customInterestRate * 100) / 100; // Round to 2 decimal places
            } else {
                // Auto-calculate based on credit score with more precision
                if (creditScore >= 760) {
                    interestRate = 6.75;
                } else if (creditScore >= 700) {
                    interestRate = 7.25;
                } else if (creditScore >= 650) {
                    interestRate = 7.85;
                } else {
                    interestRate = 8.75;
                }
                
                // Add extra rate for no credit history
                if (creditScoreType === 'no_score') {
                    const creditProfile = document.getElementById('creditProfile').value;
                    if (creditProfile === 'no_history') {
                        interestRate += 0.5; // Add 0.5% for no credit history
                    } else if (creditProfile === 'poor') {
                        interestRate += 0.25; // Add 0.25% for poor credit
                    }
                }
            }
            
            // Calculate monthly mortgage payment
            const loanTermYears = parseInt(document.getElementById('loanTerm').value);
            const monthlyRate = interestRate / 100 / 12;
            const numberOfPayments = loanTermYears * 12;
            const monthlyMortgage = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
            
            // Calculate total interest paid over the life of the loan
            const totalInterestPaid = (monthlyMortgage * numberOfPayments) - loanAmount;
            const totalLoanCost = loanAmount + totalInterestPaid;
            
            // Calculate impact of extra payments
            let extraPaymentResults = null;
            if (extraPayment > 0) {
                extraPaymentResults = calculateExtraPaymentImpact(loanAmount, monthlyRate, monthlyMortgage, extraPayment, loanTermYears);
            }
            
            // Calculate property taxes and insurance
            // Use custom annual property tax if provided, else estimate from house price
            const annualPropertyTaxInput = parseFormattedNumber(document.getElementById('propertyTax').value);
            const annualPropertyTax = annualPropertyTaxInput || (housePrice * 0.012); // 1.2% fallback
            const monthlyPropertyTax = annualPropertyTax / 12;
            
            const insuranceRate = customInsuranceRate || 0.3; // Default 0.3%
            const monthlyInsurance = (housePrice * (insuranceRate / 100)) / 12;
            
            // Total monthly payment (including HOA fees)
            const totalMonthlyPayment = monthlyMortgage + monthlyPropertyTax + monthlyInsurance + hoaFees;
            
            // Calculate 28% of monthly income
            const monthlyIncome = annualIncome / 12;
            const maxAffordablePayment = monthlyIncome * 0.28;
            
            // Calculate actual percentage of income used
            const actualIncomePercentage = (totalMonthlyPayment / monthlyIncome) * 100;
            
            // Create calculation object
            currentCalculation = {
                timestamp: new Date(),
                inputs: {
                    housePrice,
                    annualIncome,
                    downPayment,
                    creditScore,
                    loanTermYears,
                    interestRate,
                    annualPropertyTax,
                    insuranceRate,
                    hoaFees,
                    extraPayment
                },
                results: {
                    loanAmount,
                    monthlyMortgage,
                    totalInterestPaid,
                    totalLoanCost,
                    loanTermYears,
                    monthlyPropertyTax,
                    monthlyInsurance,
                    hoaFees,
                    totalMonthlyPayment,
                    monthlyIncome,
                    maxAffordablePayment,
                    actualIncomePercentage,
                    extraPaymentResults
                }
            };
            
            // Determine affordability
            let resultClass, resultIcon, resultMessage;
            
            if (totalMonthlyPayment <= maxAffordablePayment) {
                resultClass = 'success';
                resultIcon = '‚úÖ';
                resultMessage = `<strong>Yes, you can afford this house!</strong><br><br>Your estimated monthly payment of $${totalMonthlyPayment.toFixed(2)} is within the recommended 28% of your income.`;
            } else if (totalMonthlyPayment <= maxAffordablePayment * 1.15) {
                resultClass = 'warning';
                resultIcon = '‚ö†Ô∏è';
                resultMessage = `<strong>This house is borderline affordable.</strong><br><br>Your estimated monthly payment of $${totalMonthlyPayment.toFixed(2)} exceeds the recommended 28% rule. Consider improving your credit score or saving a larger down payment.`;
            } else {
                resultClass = 'danger';
                resultIcon = '‚ùå';
                resultMessage = `<strong>This house is likely out of your budget.</strong><br><br>Your estimated monthly payment of $${totalMonthlyPayment.toFixed(2)} significantly exceeds the recommended 28% of your income ($${maxAffordablePayment.toFixed(2)}).`;
            }
            
            // Add percentage highlight
            let percentageClass = 'good';
            if (actualIncomePercentage > 28) percentageClass = 'warning';
            if (actualIncomePercentage > 35) percentageClass = 'danger';
            
            const percentageHighlight = `<div class="percentage-highlight ${percentageClass}">Your payment is ${actualIncomePercentage.toFixed(1)}% of your income</div>`;
            
            // Create payment breakdown
            const breakdown = `
                <div class="payment-breakdown">
                    <h4>Monthly Payment Breakdown:</h4>
                    <div class="payment-item">
                        <span>Mortgage Payment:</span>
                        <span>$${monthlyMortgage.toFixed(2)}</span>
                    </div>
                    <div class="payment-item">
                        <span>Property Taxes ${annualPropertyTaxInput ? '(custom)' : '(estimated)'}:</span>
                        <span>$${monthlyPropertyTax.toFixed(2)}</span>
                    </div>
                    <div class="payment-item">
                        <span>Insurance (${insuranceRate.toFixed(2)}%):</span>
                        <span>$${monthlyInsurance.toFixed(2)}</span>
                    </div>
                    ${hoaFees > 0 ? `<div class="payment-item">
                        <span>HOA Fees:</span>
                        <span>$${hoaFees.toFixed(2)}</span>
                    </div>` : ''}
                    <div class="payment-item total">
                        <span>Total Monthly Payment:</span>
                        <span>$${totalMonthlyPayment.toFixed(2)}</span>
                    </div>
                    <div class="payment-item">
                        <span>Your Max Recommended (28%):</span>
                        <span>$${maxAffordablePayment.toFixed(2)}</span>
                    </div>
                    <div class="payment-item">
                        <span>Interest Rate Used:</span>
                        <span>${interestRate.toFixed(2)}%</span>
                    </div>
                </div>
                
                <div class="payment-breakdown">
                    <h4>Loan Details & Interest Information:</h4>
                    <div class="payment-item">
                        <span>Loan Term:</span>
                        <span>${loanTermYears} years (${numberOfPayments} payments)</span>
                    </div>
                    <div class="payment-item">
                        <span>Total Interest Paid:</span>
                        <span>$${totalInterestPaid.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                    </div>
                    <div class="payment-item">
                        <span>Total Cost of Loan:</span>
                        <span>$${totalLoanCost.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                    </div>
                    <div class="payment-item">
                        <span>Interest vs Principal:</span>
                        <span>${((totalInterestPaid / totalLoanCost) * 100).toFixed(1)}% interest, ${((loanAmount / totalLoanCost) * 100).toFixed(1)}% principal</span>
                    </div>
                ${extraPaymentResults ? `
                <div class="payment-breakdown" style="border-top: 2px solid #e5e7eb; margin-top: 15px; padding-top: 15px;">
                    <h4>With $${extraPayment.toFixed(2)} Extra Monthly Payment:</h4>
                    <div class="payment-item">
                        <span>New Payoff Time:</span>
                        <span>${extraPaymentResults.years} years, ${extraPaymentResults.remainingMonths} months</span>
                    </div>
                    <div class="payment-item">
                        <span>Interest Saved:</span>
                        <span>$${extraPaymentResults.interestSaved.toFixed(2)}</span>
                    </div>
                    <div class="payment-item">
                        <span>Time Saved:</span>
                        <span>${extraPaymentResults.timeSavedYears} years, ${extraPaymentResults.timeSavedRemainingMonths} months</span>
                    </div>
                </div>
                ` : ''}
                ${percentageHighlight}
            `;
            
            showResult(resultMessage + breakdown, resultClass, resultIcon);
            
            // Add to history and show export buttons
            addToHistory(currentCalculation);
            document.getElementById('exportButtons').style.display = 'flex';
        }
        
        function calculateReverseAffordability() {
            // Get input values
            const annualIncome = parseFormattedNumber(document.getElementById('annualIncome').value);
            const downPayment = parseFormattedNumber(document.getElementById('downPayment').value);
            const maxPayment = parseFormattedNumber(document.getElementById('maxPayment').value);
            
            // Get credit score or profile
            const creditScoreType = document.getElementById('creditScoreType').value;
            let creditScore;
            
            if (creditScoreType === 'have_score') {
                creditScore = parseInt(document.getElementById('creditScore').value);
            } else {
                const creditProfile = document.getElementById('creditProfile').value;
                const profileToScore = {
                    'excellent': 780,
                    'good': 720,
                    'fair': 650,
                    'poor': 620,
                    'no_history': 650
                };
                creditScore = profileToScore[creditProfile] || 650;
            }
            
            // Get optional inputs with defaults
            const customInterestRate = parseFloat(document.getElementById('interestRate').value);
            const customPropertyTaxRate = parseFloat(document.getElementById('propertyTaxRate').value);
            const customInsuranceRate = parseFloat(document.getElementById('insuranceRate').value);
            const hoaFees = parseFormattedNumber(document.getElementById('hoaFees').value);
            
            // Validate required inputs
            if (!annualIncome || !downPayment) {
                showResult('Please fill in annual income and down payment.', 'warning', '‚ö†Ô∏è');
                return;
            }
            
            if (creditScoreType === 'have_score' && (!creditScore || creditScore < 600 || creditScore > 850)) {
                showResult('Please enter a credit score between 600 and 850, or select "No Credit Score".', 'warning', '‚ö†Ô∏è');
                return;
            }
            
            // Determine interest rate
            let interestRate;
            if (customInterestRate && customInterestRate > 0) {
                interestRate = Math.round(customInterestRate * 100) / 100;
            } else {
                if (creditScore >= 760) {
                    interestRate = 6.75;
                } else if (creditScore >= 700) {
                    interestRate = 7.25;
                } else if (creditScore >= 650) {
                    interestRate = 7.85;
                } else {
                    interestRate = 8.75;
                }
                
                if (creditScoreType === 'no_score') {
                    const creditProfile = document.getElementById('creditProfile').value;
                    if (creditProfile === 'no_history') {
                        interestRate += 0.5;
                    } else if (creditProfile === 'poor') {
                        interestRate += 0.25;
                    }
                }
            }
            
            // Calculate property tax and insurance rates
            const propertyTaxRate = customPropertyTaxRate || 1.2;
            const insuranceRate = customInsuranceRate || 0.3;
            
            // Get loan term
            const loanTermYears = parseInt(document.getElementById('loanTerm').value);
            const monthlyRate = interestRate / 100 / 12;
            const numberOfPayments = loanTermYears * 12;
            
            // Calculate maximum affordable house price
            let maxAffordablePayment;
            if (maxPayment && maxPayment > 0) {
                // Use user-specified max payment
                maxAffordablePayment = maxPayment;
            } else {
                // Use 28% rule
                const monthlyIncome = annualIncome / 12;
                maxAffordablePayment = monthlyIncome * 0.28;
            }
            
            // Subtract HOA fees from available payment
            const availableForMortgage = maxAffordablePayment - hoaFees;
            
            if (availableForMortgage <= 0) {
                showResult('HOA fees exceed your maximum affordable payment. Please reduce HOA fees or increase your income/payment limit.', 'warning', '‚ö†Ô∏è');
                return;
            }
            
            // Calculate maximum loan amount using mortgage payment formula
            // P = L[c(1 + c)^n]/[(1 + c)^n - 1]
            // Solving for L: L = P * [(1 + c)^n - 1] / [c(1 + c)^n]
            const maxLoanAmount = availableForMortgage * (Math.pow(1 + monthlyRate, numberOfPayments) - 1) / (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments));
            
            // Calculate maximum house price
            const maxHousePrice = maxLoanAmount + downPayment;
            
            // Calculate estimated property taxes and insurance
            const estimatedPropertyTax = (maxHousePrice * propertyTaxRate / 100) / 12;
            const estimatedInsurance = (maxHousePrice * insuranceRate / 100) / 12;
            const totalMonthlyPayment = availableForMortgage + estimatedPropertyTax + estimatedInsurance + hoaFees;
            
            // Check if total payment exceeds income guidelines
            const monthlyIncome = annualIncome / 12;
            const paymentToIncomeRatio = (totalMonthlyPayment / monthlyIncome) * 100;
            
            // Store calculation for history
            currentCalculation = {
                type: 'reverse',
                annualIncome: annualIncome,
                downPayment: downPayment,
                maxPayment: maxPayment || 'Based on 28% rule',
                creditScore: creditScore,
                interestRate: interestRate,
                loanTerm: loanTermYears,
                maxHousePrice: maxHousePrice,
                maxLoanAmount: maxLoanAmount,
                monthlyPayment: totalMonthlyPayment,
                paymentToIncomeRatio: paymentToIncomeRatio,
                timestamp: new Date().toISOString()
            };
            
            // Format currency
            const currency = document.getElementById('currency').value;
            const symbol = currencySymbols[currency] || '$';
            
            // Determine result class and icon
            let resultClass, resultIcon;
            if (paymentToIncomeRatio <= 28) {
                resultClass = 'success';
                resultIcon = '‚úÖ';
            } else if (paymentToIncomeRatio <= 35) {
                resultClass = 'warning';
                resultIcon = '‚ö†Ô∏è';
            } else {
                resultClass = 'danger';
                resultIcon = '‚ùå';
            }
            
            const resultMessage = `
                <h3>Maximum House Price: ${symbol}${maxHousePrice.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0})}</h3>
                <p><strong>Based on your income of ${symbol}${annualIncome.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0})} and down payment of ${symbol}${downPayment.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0})}</strong></p>
            `;
            
            const breakdown = `
                <div class="calculation-breakdown">
                    <h4>üí∞ Payment Breakdown:</h4>
                    <div class="breakdown-item">
                        <span>Monthly Mortgage Payment:</span>
                        <span>${symbol}${availableForMortgage.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0})}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Property Tax (est.):</span>
                        <span>${symbol}${estimatedPropertyTax.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0})}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Insurance (est.):</span>
                        <span>${symbol}${estimatedInsurance.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0})}</span>
                    </div>
                    ${hoaFees > 0 ? `
                    <div class="breakdown-item">
                        <span>HOA Fees:</span>
                        <span>${symbol}${hoaFees.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0})}</span>
                    </div>
                    ` : ''}
                    <div class="breakdown-item total">
                        <span><strong>Total Monthly Payment:</strong></span>
                        <span><strong>${symbol}${totalMonthlyPayment.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0})}</strong></span>
                    </div>
                    <div class="breakdown-item">
                        <span>Payment-to-Income Ratio:</span>
                        <span><strong>${paymentToIncomeRatio.toFixed(1)}%</strong></span>
                    </div>
                    
                    <h4>üìä Loan Details:</h4>
                    <div class="breakdown-item">
                        <span>Loan Amount:</span>
                        <span>${symbol}${maxLoanAmount.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0})}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Interest Rate:</span>
                        <span>${interestRate.toFixed(2)}%</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Loan Term:</span>
                        <span>${loanTermYears} years</span>
                    </div>
                </div>
            `;
            
            showResult(resultMessage + breakdown, resultClass, resultIcon);
            
            // Add to history and show export buttons
            addToHistory(currentCalculation);
            document.getElementById('exportButtons').style.display = 'flex';
        }
        
        function showResult(message, className, icon) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<span class="result-icon">${icon}</span>${message}`;
            resultDiv.className = `result ${className}`;
            resultDiv.style.display = 'block';
            
            // Smooth scroll to result
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        function addToHistory(calculation) {
            calculationHistory.unshift(calculation); // Add to beginning of array
            updateHistoryDisplay();
        }
        
        function updateHistoryDisplay() {
            const historyContainer = document.getElementById('historyContainer');
            const historySection = document.getElementById('historySection');
            
            if (calculationHistory.length === 0) {
                historyContainer.innerHTML = '<p style="text-align: center; color: #6b7280;">No calculations yet. Run a calculation to see your history here.</p>';
                historySection.classList.remove('show');
                return;
            }
            
            historySection.classList.add('show');
            
            let historyHTML = '';
            calculationHistory.forEach((calc, index) => {
                const timestamp = calc.timestamp.toLocaleString();
                const affordability = calc.results.totalMonthlyPayment <= calc.results.maxAffordablePayment ? 'Affordable' : 'Over Budget';
                const affordabilityClass = calc.results.totalMonthlyPayment <= calc.results.maxAffordablePayment ? 'good' : 'danger';
                
                historyHTML += `
                    <div class="history-item">
                        <div class="history-header">
                            <div class="history-title">$${calc.inputs.housePrice.toLocaleString()} House</div>
                            <div class="history-timestamp">${timestamp}</div>
                        </div>
                        <div class="history-summary">
                            <div class="history-stat">
                                <div class="history-stat-label">Monthly Payment</div>
                                <div class="history-stat-value">$${calc.results.totalMonthlyPayment.toFixed(2)}</div>
                            </div>
                            <div class="history-stat">
                                <div class="history-stat-label">% of Income</div>
                                <div class="history-stat-value">${calc.results.actualIncomePercentage.toFixed(1)}%</div>
                            </div>
                            <div class="history-stat">
                                <div class="history-stat-label">Interest Rate</div>
                                <div class="history-stat-value">${calc.inputs.interestRate.toFixed(2)}%</div>
                            </div>
                            <div class="history-stat">
                                <div class="history-stat-label">Affordability</div>
                                <div class="history-stat-value ${affordabilityClass}">${affordability}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            historyContainer.innerHTML = historyHTML;
        }
        
        function exportToCSV() {
            if (calculationHistory.length === 0) {
                alert('No calculations to export. Run a calculation first.');
                return;
            }
            
            let csvContent = 'Timestamp,House Price,Annual Income,Down Payment,Credit Score,Loan Term Years,Interest Rate,Annual Property Tax,Insurance Rate,HOA Fees,Loan Amount,Monthly Mortgage,Total Interest Paid,Total Loan Cost,Monthly Property Tax,Monthly Insurance,HOA Fees Monthly,Total Monthly Payment,Monthly Income,Max Affordable Payment,Actual Income Percentage,Affordable\n';
            
            calculationHistory.forEach(calc => {
                const affordable = calc.results.totalMonthlyPayment <= calc.results.maxAffordablePayment ? 'Yes' : 'No';
                csvContent += `${calc.timestamp.toISOString()},${calc.inputs.housePrice},${calc.inputs.annualIncome},${calc.inputs.downPayment},${calc.inputs.creditScore},${calc.inputs.loanTermYears},${calc.inputs.interestRate},${calc.inputs.annualPropertyTax},${calc.inputs.insuranceRate},${calc.inputs.hoaFees || 0},${calc.results.loanAmount.toFixed(2)},${calc.results.monthlyMortgage.toFixed(2)},${(calc.results.totalInterestPaid || 0).toFixed(2)},${(calc.results.totalLoanCost || 0).toFixed(2)},${calc.results.monthlyPropertyTax.toFixed(2)},${calc.results.monthlyInsurance.toFixed(2)},${(calc.inputs.hoaFees || 0).toFixed(2)},${calc.results.totalMonthlyPayment.toFixed(2)},${calc.results.monthlyIncome.toFixed(2)},${calc.results.maxAffordablePayment.toFixed(2)},${calc.results.actualIncomePercentage.toFixed(2)},${affordable}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'house_affordability_calculations.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function exportToText() {
            if (!currentCalculation) {
                alert('No current calculation to copy. Run a calculation first.');
                return;
            }
            
            const calc = currentCalculation;
            const affordable = calc.results.totalMonthlyPayment <= calc.results.maxAffordablePayment ? 'Yes' : 'No';
            
            const textContent = `House Affordability Calculation Results
Generated: ${calc.timestamp.toLocaleString()}

INPUTS:
House Price: $${calc.inputs.housePrice.toLocaleString()}
Annual Income: $${calc.inputs.annualIncome.toLocaleString()}
Down Payment: $${calc.inputs.downPayment.toLocaleString()}
Credit Score: ${calc.inputs.creditScore}
Loan Term: ${calc.inputs.loanTermYears} years
Interest Rate: ${calc.inputs.interestRate.toFixed(2)}%
Annual Property Tax: $${calc.inputs.annualPropertyTax.toFixed(2)}
Insurance Rate: ${calc.inputs.insuranceRate.toFixed(2)}%
Monthly HOA Fees: $${(calc.inputs.hoaFees || 0).toFixed(2)}

RESULTS:
Loan Amount: $${calc.results.loanAmount.toFixed(2)}
Monthly Mortgage: $${calc.results.monthlyMortgage.toFixed(2)}
Total Interest Paid: $${(calc.results.totalInterestPaid || 0).toFixed(2)}
Total Cost of Loan: $${(calc.results.totalLoanCost || 0).toFixed(2)}
Loan Term: ${calc.inputs.loanTermYears} years
Monthly Property Tax: $${calc.results.monthlyPropertyTax.toFixed(2)}
Monthly Insurance: $${calc.results.monthlyInsurance.toFixed(2)}
${calc.inputs.hoaFees > 0 ? `Monthly HOA Fees: $${calc.inputs.hoaFees.toFixed(2)}\n` : ''}Total Monthly Payment: $${calc.results.totalMonthlyPayment.toFixed(2)}
Monthly Income: $${calc.results.monthlyIncome.toFixed(2)}
Max Affordable Payment (28%): $${calc.results.maxAffordablePayment.toFixed(2)}
Actual Income Percentage: ${calc.results.actualIncomePercentage.toFixed(1)}%
Affordable: ${affordable}

Generated by Can I Afford This House Calculator`;
            
            navigator.clipboard.writeText(textContent).then(() => {
                alert('Calculation results copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = textContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Calculation results copied to clipboard!');
            });
        }
        
        function clearHistory() {
            if (confirm('Are you sure you want to clear all calculation history?')) {
                calculationHistory = [];
                updateHistoryDisplay();
                document.getElementById('exportButtons').style.display = 'none';
            }
        }
        
        // Add number formatting to inputs
        document.getElementById('housePrice').addEventListener('input', function(e) {
            formatNumberInput(e.target);
        });
        
        document.getElementById('annualIncome').addEventListener('input', function(e) {
            formatNumberInput(e.target);
        });
        
        document.getElementById('downPayment').addEventListener('input', function(e) {
            formatNumberInput(e.target);
        });
        
        document.getElementById('propertyTax').addEventListener('input', function(e) {
            formatNumberInput(e.target);
        });
        
        document.getElementById('hoaFees').addEventListener('input', function(e) {
            formatNumberInput(e.target);
        });
        
        document.getElementById('extraPayment').addEventListener('input', function(e) {
            formatNumberInput(e.target);
        });
        
        function formatNumberInput(input) {
            // Store cursor position
            const cursorPosition = input.selectionStart;
            const oldValue = input.value;
            
            // Remove any non-digit characters except decimal point
            let value = input.value.replace(/[^\d.]/g, '');
            
            // Ensure only one decimal point
            const parts = value.split('.');
            if (parts.length > 2) {
                value = parts[0] + '.' + parts.slice(1).join('');
            }
            
            // Add commas for thousands separator
            if (parts[0]) {
                const integerPart = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                value = parts[1] !== undefined ? integerPart + '.' + parts[1] : integerPart;
            }
            
            input.value = value;
            
            // Restore cursor position, accounting for added commas
            const newCommas = (value.match(/,/g) || []).length;
            const oldCommas = (oldValue.match(/,/g) || []).length;
            const newPosition = cursorPosition + (newCommas - oldCommas);
            input.setSelectionRange(newPosition, newPosition);
        }
        
        // Function to parse formatted number input (remove commas)
        function parseFormattedNumber(value) {
            return parseFloat(value.replace(/,/g, '')) || 0;
        }
        
        function calculateExtraPaymentImpact(loanAmount, monthlyRate, regularPayment, extraPayment, originalLoanTermYears) {
            let balance = loanAmount;
            let totalInterest = 0;
            let months = 0;
            const maxMonths = 360; // 30 years max to prevent infinite loops
            
            while (balance > 0.01 && months < maxMonths) {
                const interestPayment = balance * monthlyRate;
                const principalPayment = regularPayment - interestPayment + extraPayment;
                
                if (principalPayment <= 0) break; // Safety check
                
                totalInterest += interestPayment;
                balance -= principalPayment;
                months++;
                
                if (balance < 0) balance = 0;
            }
            
            const years = Math.floor(months / 12);
            const remainingMonths = months % 12;
            
            // Calculate original loan details for comparison
            const originalMonths = originalLoanTermYears * 12;
            let originalBalance = loanAmount;
            let originalTotalInterest = 0;
            let originalMonthCount = 0;
            
            while (originalBalance > 0.01 && originalMonthCount < originalMonths) {
                const interestPayment = originalBalance * monthlyRate;
                const principalPayment = regularPayment - interestPayment;
                
                if (principalPayment <= 0) break;
                
                originalTotalInterest += interestPayment;
                originalBalance -= principalPayment;
                originalMonthCount++;
                
                if (originalBalance < 0) originalBalance = 0;
            }
            
            const interestSaved = originalTotalInterest - totalInterest;
            const timeSaved = originalMonths - months;
            const timeSavedYears = Math.floor(timeSaved / 12);
            const timeSavedRemainingMonths = timeSaved % 12;
            
            return {
                months: months,
                years: years,
                remainingMonths: remainingMonths,
                totalInterest: totalInterest,
                interestSaved: Math.max(0, interestSaved),
                timeSaved: Math.max(0, timeSaved),
                timeSavedYears: timeSavedYears,
                timeSavedRemainingMonths: timeSavedRemainingMonths
            };
        }
    </script>
</body>
</html>


    </script>
</body>
</html>

